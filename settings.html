<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="sidebar.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .main-content {
            padding: 2rem;
        }

        .header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .settings-container {
            display: grid;
            gap: 2rem;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .time-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e9ecef;
        }

        .info-text {
            font-size: 0.9rem;
            color: #6c757d;
            font-style: italic;
            margin-top: 0.5rem;
        }

        .icon {
            width: 20px;
            height: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .time-input {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        body.dark, .dark body {
            background-color: #18181b !important;
            color: #e5e7eb !important;
        }
        .dark .main-content, .dark .settings-section, .dark .header {
            background: #23272f !important;
            color: #e5e7eb !important;
        }
        .dark .form-group input,
        .dark .form-group select,
        .dark .form-group textarea {
            background: #18181b !important;
            color: #e5e7eb !important;
            border-color: #374151 !important;
        }
        .dark .btn {
            background: linear-gradient(135deg, #6366f1 0%, #23272f 100%) !important;
            color: #fff !important;
        }
        .dark .btn-secondary {
            background: #374151 !important;
        }
        .dark .settings-section {
            border-color: #374151 !important;
        }
        .dark .section-title {
            border-bottom: 2px solid #6366f1 !important;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div id="sidebar-container"></div>
       
        <div class="main-content">
            <div class="header flex justify-between items-center">
                <div>
                    <h1>‚öôÔ∏è System Settings</h1>
                    <p>Configure your library attendance and circulation monitoring system</p>
                </div>
            </div>

            <div class="settings-container">
                <!-- General Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        üèõÔ∏è General Settings
                    </h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="library-name">Library Name</label>
                            <input type="text" id="library-name" value="Central Public Library" />
                        </div>
                        <div class="form-group">
                            <label for="library-code">Library Code</label>
                            <input type="text" id="library-code" value="CPL001" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="library-address">Library Address</label>
                        <textarea id="library-address" rows="3">123 Main Street, City Center, Metro Manila, Philippines</textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contact-phone">Contact Phone</label>
                            <input type="tel" id="contact-phone" value="+63 2 1234 5678" />
                        </div>
                        <div class="form-group">
                            <label for="contact-email">Contact Email</label>
                            <input type="email" id="contact-email" value="info@centrallibrary.ph" />
                        </div>
                    </div>
                </div>

                <!-- Operating Hours -->
                <div class="settings-section">
                    <h2 class="section-title">
                        üïí Operating Hours
                    </h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="open-time">Opening Time</label>
                            <input type="time" id="open-time" value="08:00" />
                        </div>
                        <div class="form-group">
                            <label for="close-time">Closing Time</label>
                            <input type="time" id="close-time" value="20:00" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Operating Days</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; margin-top: 0.5rem;">
                            <div class="checkbox-group">
                                <input type="checkbox" id="monday" checked>
                                <label for="monday">Monday</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="tuesday" checked>
                                <label for="tuesday">Tuesday</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="wednesday" checked>
                                <label for="wednesday">Wednesday</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="thursday" checked>
                                <label for="thursday">Thursday</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="friday" checked>
                                <label for="friday">Friday</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="saturday" checked>
                                <label for="saturday">Saturday</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="sunday">
                                <label for="sunday">Sunday</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        üë• Attendance Monitoring
                    </h2>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enable-attendance" checked>
                        <label for="enable-attendance">Enable Attendance Tracking</label>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="attendance-method">Attendance Method</label>
                            <select id="attendance-method">
                                <option value="barcode">Barcode Scanning</option>
                                <option value="rfid">RFID Card</option>
                                <option value="manual">Manual Entry</option>
                                <option value="biometric">Biometric</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="auto-checkout">Auto Checkout After (hours)</label>
                            <input type="number" id="auto-checkout" value="8" min="1" max="24" />
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="guest-tracking" checked>
                        <label for="guest-tracking">Track Guest Visitors</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="attendance-reports">
                        <label for="attendance-reports">Generate Daily Attendance Reports</label>
                    </div>
                </div>

                <!-- Circulation Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        üìñ Circulation Settings
                    </h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="loan-period">Default Loan Period (days)</label>
                            <input type="number" id="loan-period" value="14" min="1" max="365" />
                        </div>
                        <div class="form-group">
                            <label for="renewal-limit">Maximum Renewals</label>
                            <input type="number" id="renewal-limit" value="2" min="0" max="10" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="max-books">Maximum Books per Member</label>
                            <input type="number" id="max-books" value="5" min="1" max="50" />
                        </div>
                        <div class="form-group">
                            <label for="fine-per-day">Fine per Day (PHP)</label>
                            <input type="number" id="fine-per-day" value="5.00" step="0.01" min="0" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="grace-period">Grace Period (days)</label>
                            <input type="number" id="grace-period" value="3" min="0" max="30" />
                        </div>
                        <div class="form-group">
                            <label for="max-fine">Maximum Fine Amount (PHP)</label>
                            <input type="number" id="max-fine" value="500.00" step="0.01" min="0" />
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="auto-renewal" checked>
                        <label for="auto-renewal">Enable Auto-Renewal (if no holds)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="overdue-notifications" checked>
                        <label for="overdue-notifications">Send Overdue Notifications</label>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        üîî Notification Settings
                    </h2>
                    <div class="form-group">
                        <label for="notification-method">Primary Notification Method</label>
                        <select id="notification-method">
                            <option value="email">Email</option>
                            <option value="sms">SMS</option>
                            <option value="both">Email & SMS</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="due-reminder">Due Date Reminder (days before)</label>
                            <input type="number" id="due-reminder" value="3" min="0" max="30" />
                        </div>
                        <div class="form-group">
                            <label for="overdue-reminder">Overdue Reminder Frequency (days)</label>
                            <input type="number" id="overdue-reminder" value="7" min="1" max="30" />
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="checkout-notification" checked>
                        <label for="checkout-notification">Send Checkout Confirmations</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="return-notification">
                        <label for="return-notification">Send Return Confirmations</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="hold-notification" checked>
                        <label for="hold-notification">Send Hold Available Notifications</label>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        üîí Security Settings
                    </h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="session-timeout">Session Timeout (minutes)</label>
                            <input type="number" id="session-timeout" value="30" min="5" max="480" />
                        </div>
                        <div class="form-group">
                            <label for="backup-frequency">Backup Frequency</label>
                            <select id="backup-frequency">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="audit-log" checked>
                        <label for="audit-log">Enable Audit Logging</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="login-attempts">
                        <label for="login-attempts">Lock Account After Failed Login Attempts</label>
                    </div>
                    <div class="form-group">
                        <label for="max-attempts">Maximum Login Attempts</label>
                        <input type="number" id="max-attempts" value="3" min="1" max="10" />
                        <div class="info-text">Account will be locked after this many failed login attempts</div>
                    </div>
                </div>

                <!-- System Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        üíª System Settings
                    </h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="timezone">Timezone</label>
                            <select id="timezone">
                                <option value="Asia/Manila" selected>Asia/Manila (GMT+8)</option>
                                <option value="UTC">UTC (GMT+0)</option>
                                <option value="America/New_York">America/New_York (GMT-5)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date-format">Date Format</label>
                            <select id="date-format">
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="language">System Language</label>
                            <select id="language">
                                <option value="en" selected>English</option>
                                <option value="fil">Filipino</option>
                                <option value="es">Spanish</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="currency">Currency</label>
                            <select id="currency">
                                <option value="PHP" selected>Philippine Peso (PHP)</option>
                                <option value="USD">US Dollar (USD)</option>
                                <option value="EUR">Euro (EUR)</option>
                            </select>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="maintenance-mode">
                        <label for="maintenance-mode">Maintenance Mode</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="debug-mode">
                        <label for="debug-mode">Debug Mode</label>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="resetSettings()">Reset to Default</button>
                <button class="btn" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>
    <script src="sidebar.js"></script>

    <script>
        // Form validation and saving functionality
        function saveSettings() {
            // Collect all form data
            const settings = {
                general: {
                    libraryName: document.getElementById('library-name').value,
                    libraryCode: document.getElementById('library-code').value,
                    libraryAddress: document.getElementById('library-address').value,
                    contactPhone: document.getElementById('contact-phone').value,
                    contactEmail: document.getElementById('contact-email').value
                },
                operatingHours: {
                    openTime: document.getElementById('open-time').value,
                    closeTime: document.getElementById('close-time').value,
                    operatingDays: {
                        monday: document.getElementById('monday').checked,
                        tuesday: document.getElementById('tuesday').checked,
                        wednesday: document.getElementById('wednesday').checked,
                        thursday: document.getElementById('thursday').checked,
                        friday: document.getElementById('friday').checked,
                        saturday: document.getElementById('saturday').checked,
                        sunday: document.getElementById('sunday').checked
                    }
                },
                attendance: {
                    enableAttendance: document.getElementById('enable-attendance').checked,
                    attendanceMethod: document.getElementById('attendance-method').value,
                    autoCheckout: document.getElementById('auto-checkout').value,
                    guestTracking: document.getElementById('guest-tracking').checked,
                    attendanceReports: document.getElementById('attendance-reports').checked
                },
                circulation: {
                    loanPeriod: document.getElementById('loan-period').value,
                    renewalLimit: document.getElementById('renewal-limit').value,
                    maxBooks: document.getElementById('max-books').value,
                    finePerDay: document.getElementById('fine-per-day').value,
                    gracePeriod: document.getElementById('grace-period').value,
                    maxFine: document.getElementById('max-fine').value,
                    autoRenewal: document.getElementById('auto-renewal').checked,
                    overdueNotifications: document.getElementById('overdue-notifications').checked
                },
                notifications: {
                    notificationMethod: document.getElementById('notification-method').value,
                    dueReminder: document.getElementById('due-reminder').value,
                    overdueReminder: document.getElementById('overdue-reminder').value,
                    checkoutNotification: document.getElementById('checkout-notification').checked,
                    returnNotification: document.getElementById('return-notification').checked,
                    holdNotification: document.getElementById('hold-notification').checked
                },
                security: {
                    sessionTimeout: document.getElementById('session-timeout').value,
                    backupFrequency: document.getElementById('backup-frequency').value,
                    auditLog: document.getElementById('audit-log').checked,
                    loginAttempts: document.getElementById('login-attempts').checked,
                    maxAttempts: document.getElementById('max-attempts').value
                },
                system: {
                    timezone: document.getElementById('timezone').value,
                    dateFormat: document.getElementById('date-format').value,
                    language: document.getElementById('language').value,
                    currency: document.getElementById('currency').value,
                    maintenanceMode: document.getElementById('maintenance-mode').checked,
                    debugMode: document.getElementById('debug-mode').checked
                }
            };

            // Validate required fields
            if (!settings.general.libraryName.trim()) {
                alert('Library Name is required');
                return;
            }

            if (!settings.general.libraryCode.trim()) {
                alert('Library Code is required');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (settings.general.contactEmail && !emailRegex.test(settings.general.contactEmail)) {
                alert('Please enter a valid email address');
                return;
            }

            // Validate numeric values
            if (settings.circulation.loanPeriod < 1) {
                alert('Loan period must be at least 1 day');
                return;
            }

            if (settings.circulation.finePerDay < 0) {
                alert('Fine per day cannot be negative');
                return;
            }

            // In a real application, this would send data to the server
            console.log('Settings saved:', settings);
            
            // Show success message
            alert('Settings saved successfully!');
            
            // Add visual feedback
            const saveBtn = document.querySelector('.btn:not(.btn-secondary)');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'Saved!';
            saveBtn.style.background = '#28a745';
            
            setTimeout(() => {
                saveBtn.textContent = originalText;
                saveBtn.style.background = '';
            }, 2000);
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to default values? This action cannot be undone.')) {
                // Reset all form fields to default values
                document.getElementById('library-name').value = 'Central Public Library';
                document.getElementById('library-code').value = 'CPL001';
                document.getElementById('library-address').value = '123 Main Street, City Center, Metro Manila, Philippines';
                document.getElementById('contact-phone').value = '+63 2 1234 5678';
                document.getElementById('contact-email').value = 'info@centrallibrary.ph';
                
                document.getElementById('open-time').value = '08:00';
                document.getElementById('close-time').value = '20:00';
                
                // Reset checkboxes
                document.getElementById('monday').checked = true;
                document.getElementById('tuesday').checked = true;
                document.getElementById('wednesday').checked = true;
                document.getElementById('thursday').checked = true;
                document.getElementById('friday').checked = true;
                document.getElementById('saturday').checked = true;
                document.getElementById('sunday').checked = false;
                
                document.getElementById('enable-attendance').checked = true;
                document.getElementById('attendance-method').value = 'barcode';
                document.getElementById('auto-checkout').value = 8;
                document.getElementById('guest-tracking').checked = true;
                document.getElementById('attendance-reports').checked = false;
                
                document.getElementById('loan-period').value = 14;
                document.getElementById('renewal-limit').value = 2;
                document.getElementById('max-books').value = 5;
                document.getElementById('fine-per-day').value = 5.00;
                document.getElementById('grace-period').value = 3;
                document.getElementById('max-fine').value = 500.00;
                document.getElementById('auto-renewal').checked = true;
                document.getElementById('overdue-notifications').checked = true;
                
                document.getElementById('notification-method').value = 'email';
                document.getElementById('due-reminder').value = 3;
                document.getElementById('overdue-reminder').value = 7;
                document.getElementById('checkout-notification').checked = true;
                document.getElementById('return-notification').checked = false;
                document.getElementById('hold-notification').checked = true;
                
                document.getElementById('session-timeout').value = 30;
                document.getElementById('backup-frequency').value = 'daily';
                document.getElementById('audit-log').checked = true;
                document.getElementById('login-attempts').checked = false;
                document.getElementById('max-attempts').value = 3;
                
                document.getElementById('timezone').value = 'Asia/Manila';
                document.getElementById('date-format').value = 'DD/MM/YYYY';
                document.getElementById('language').value = 'en';
                document.getElementById('currency').value = 'PHP';
                document.getElementById('maintenance-mode').checked = false;
                document.getElementById('debug-mode').checked = false;
                
                alert('Settings have been reset to default values.');
            }
        }

        // Add form validation on input
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for real-time validation
            const emailInput = document.getElementById('contact-email');
            emailInput.addEventListener('blur', function() {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (this.value && !emailRegex.test(this.value)) {
                    this.style.borderColor = '#dc3545';
                } else {
                    this.style.borderColor = '#e9ecef';
                }
            });

            // Add number validation
            const numberInputs = document.querySelectorAll('input[type="number"]');
            numberInputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (this.value < 0) {
                        this.style.borderColor = '#dc3545';
                    } else {
                        this.style.borderColor = '#e9ecef';
                    }
                });
            });
        });

        // Fetch settings from backend on load
        async function loadSettingsFromBackend() {
            try {
                const res = await fetch('get_settings.php');
                const data = await res.json();
                if (data.success && data.settings) {
                    const s = data.settings;
                    document.getElementById('library-name').value = s.general.libraryName || '';
                    document.getElementById('library-code').value = s.general.libraryCode || '';
                    document.getElementById('library-address').value = s.general.libraryAddress || '';
                    document.getElementById('contact-phone').value = s.general.contactPhone || '';
                    document.getElementById('contact-email').value = s.general.contactEmail || '';
                    document.getElementById('open-time').value = s.operatingHours.openTime || '';
                    document.getElementById('close-time').value = s.operatingHours.closeTime || '';
                    ['monday','tuesday','wednesday','thursday','friday','saturday','sunday'].forEach(day => {
                        document.getElementById(day).checked = !!s.operatingHours.operatingDays[day];
                    });
                    document.getElementById('enable-attendance').checked = !!s.attendance.enableAttendance;
                    document.getElementById('attendance-method').value = s.attendance.attendanceMethod || 'barcode';
                    document.getElementById('auto-checkout').value = s.attendance.autoCheckout || 8;
                    document.getElementById('guest-tracking').checked = !!s.attendance.guestTracking;
                    document.getElementById('attendance-reports').checked = !!s.attendance.attendanceReports;
                    document.getElementById('loan-period').value = s.circulation.loanPeriod || 14;
                    document.getElementById('renewal-limit').value = s.circulation.renewalLimit || 2;
                    document.getElementById('max-books').value = s.circulation.maxBooks || 5;
                    document.getElementById('fine-per-day').value = s.circulation.finePerDay || 5.00;
                    document.getElementById('grace-period').value = s.circulation.gracePeriod || 3;
                    document.getElementById('max-fine').value = s.circulation.maxFine || 500.00;
                    document.getElementById('auto-renewal').checked = !!s.circulation.autoRenewal;
                    document.getElementById('overdue-notifications').checked = !!s.circulation.overdueNotifications;
                    document.getElementById('notification-method').value = s.notifications.notificationMethod || 'email';
                    document.getElementById('due-reminder').value = s.notifications.dueReminder || 3;
                    document.getElementById('overdue-reminder').value = s.notifications.overdueReminder || 7;
                    document.getElementById('checkout-notification').checked = !!s.notifications.checkoutNotification;
                    document.getElementById('return-notification').checked = !!s.notifications.returnNotification;
                    document.getElementById('hold-notification').checked = !!s.notifications.holdNotification;
                    document.getElementById('session-timeout').value = s.security.sessionTimeout || 30;
                    document.getElementById('backup-frequency').value = s.security.backupFrequency || 'daily';
                    document.getElementById('audit-log').checked = !!s.security.auditLog;
                    document.getElementById('login-attempts').checked = !!s.security.loginAttempts;
                    document.getElementById('max-attempts').value = s.security.maxAttempts || 3;
                    document.getElementById('timezone').value = s.system.timezone || 'Asia/Manila';
                    document.getElementById('date-format').value = s.system.dateFormat || 'DD/MM/YYYY';
                    document.getElementById('language').value = s.system.language || 'en';
                    document.getElementById('currency').value = s.system.currency || 'PHP';
                    document.getElementById('maintenance-mode').checked = !!s.system.maintenanceMode;
                    document.getElementById('debug-mode').checked = !!s.system.debugMode;
                }
            } catch (e) {
                alert('Failed to load settings from server.');
            }
        }

        // Save settings to backend
        async function saveSettings() {
            // ... collect settings as before ...
            const settings = { /* ... as before ... */ };
            try {
                const res = await fetch('save_settings.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                const data = await res.json();
                if (data.success) {
                    alert('Settings saved successfully!');
                } else {
                    alert('Failed to save settings.');
                }
            } catch (e) {
                alert('Failed to save settings.');
            }
        }

        document.addEventListener('DOMContentLoaded', loadSettingsFromBackend);
    </script>
</body>
</html>